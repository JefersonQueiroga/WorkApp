{% extends 'base.html' %}

{% block title %}{{ titulo }} - WorkApp{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-person-{% if form.instance.pk %}gear{% else %}plus{% endif %}"></i>
                        {{ titulo }}
                    </h4>
                </div>
                <div class="card-body p-4">
                    
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}

                        <!-- Dados de Acesso -->
                        <div class="section-title mb-3">
                            <h5 class="text-success border-bottom pb-2">
                                <i class="bi bi-key"></i> Dados de Acesso
                            </h5>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.username.id_for_label }}" class="form-label fw-bold">
                                    Nome de Usuário <span class="text-danger">*</span>
                                </label>
                                {{ form.username }}
                                {% if form.username.errors %}
                                    <div class="text-danger small mt-1">{{ form.username.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.email.id_for_label }}" class="form-label fw-bold">
                                    E-mail <span class="text-danger">*</span>
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="text-danger small mt-1">{{ form.email.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        {% if not form.instance.pk %}
                        <!-- Senhas (apenas na criação) -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.password1.id_for_label }}" class="form-label fw-bold">
                                    Senha <span class="text-danger">*</span>
                                </label>
                                {{ form.password1 }}
                                {% if form.password1.errors %}
                                    <div class="text-danger small mt-1">{{ form.password1.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.password2.id_for_label }}" class="form-label fw-bold">
                                    Confirmar Senha <span class="text-danger">*</span>
                                </label>
                                {{ form.password2 }}
                                {% if form.password2.errors %}
                                    <div class="text-danger small mt-1">{{ form.password2.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Dados Pessoais -->
                        <div class="section-title mb-3 mt-4">
                            <h5 class="text-success border-bottom pb-2">
                                <i class="bi bi-person"></i> Dados Pessoais
                            </h5>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.first_name.id_for_label }}" class="form-label fw-bold">
                                    Primeiro Nome
                                </label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="text-danger small mt-1">{{ form.first_name.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.last_name.id_for_label }}" class="form-label fw-bold">
                                    Sobrenome
                                </label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="text-danger small mt-1">{{ form.last_name.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.cpf.id_for_label }}" class="form-label fw-bold">
                                    CPF <span class="text-danger">*</span>
                                </label>
                                {{ form.cpf }}
                                {% if form.cpf.errors %}
                                    <div class="text-danger small mt-1">{{ form.cpf.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.nome_mae.id_for_label }}" class="form-label fw-bold">
                                    Nome da Mãe
                                </label>
                                {{ form.nome_mae }}
                                {% if form.nome_mae.errors %}
                                    <div class="text-danger small mt-1">{{ form.nome_mae.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Foto de Perfil -->
                        {% if form.instance.pk %}
                        <div class="mb-3">
                            <label for="{{ form.foto_perfil.id_for_label }}" class="form-label fw-bold">
                                Foto de Perfil
                            </label>
                            {% if form.instance.foto_perfil %}
                               <div class="mb-2">
                                    <img src="{{ form.instance.foto_perfil.url }}" alt="Foto atual" class="img-thumbnail" style="max-width: 150px;">
                                </div>
                            {% endif %}
                            {{ form.foto_perfil }}
                            {% if form.foto_perfil.errors %}
                                <div class="text-danger small mt-1">{{ form.foto_perfil.errors }}</div>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Endereço -->
                        <div class="section-title mb-3 mt-4">
                            <h5 class="text-success border-bottom pb-2">
                                <i class="bi bi-geo-alt"></i> Endereço
                            </h5>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.endereco.id_for_label }}" class="form-label fw-bold">
                                Endereço Completo
                            </label>
                            {{ form.endereco }}
                            {% if form.endereco.errors %}
                                <div class="text-danger small mt-1">{{ form.endereco.errors }}</div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.nome_bairro.id_for_label }}" class="form-label fw-bold">
                                    Bairro
                                </label>
                                {{ form.nome_bairro }}
                                {% if form.nome_bairro.errors %}
                                    <div class="text-danger small mt-1">{{ form.nome_bairro.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.nome_cidade.id_for_label }}" class="form-label fw-bold">
                                    Cidade
                                </label>
                                {{ form.nome_cidade }}
                                {% if form.nome_cidade.errors %}
                                    <div class="text-danger small mt-1">{{ form.nome_cidade.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Permissões e Grupos (apenas na edição) -->
                        {% if form.instance.pk %}
                        <div class="section-title mb-3 mt-4">
                            <h5 class="text-success border-bottom pb-2">
                                <i class="bi bi-shield-lock"></i> Permissões e Grupos
                            </h5>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    {{ form.is_active }}
                                    <label class="form-check-label fw-bold" for="{{ form.is_active.id_for_label }}">
                                        Usuário Ativo
                                    </label>
                                </div>
                                <small class="text-muted">Desmarque para desativar o usuário sem deletá-lo</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    {{ form.is_staff }}
                                    <label class="form-check-label fw-bold" for="{{ form.is_staff.id_for_label }}">
                                        Acesso ao Painel Admin
                                    </label>
                                </div>
                                <small class="text-muted">Permite acesso ao Django Admin</small>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                <i class="bi bi-people-fill"></i> Grupos
                            </label>
                            <div class="card bg-light p-3">
                                {{ form.grupos }}
                            </div>
                            {% if form.grupos.errors %}
                                <div class="text-danger small mt-1">{{ form.grupos.errors }}</div>
                            {% endif %}
                            <small class="text-muted">Selecione os grupos aos quais o usuário pertence</small>
                        </div>
                        {% endif %}

                        <!-- Erros gerais -->
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger mt-3">
                                {{ form.non_field_errors }}
                            </div>
                        {% endif %}

                        <!-- Botões de Ação -->
                        <div class="d-flex gap-2 justify-content-end mt-4 pt-3 border-top">
                            <a href="{% url 'listar_usuarios' %}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-success">
                                <i class="bi bi-check-circle"></i> 
                                {% if form.instance.pk %}Atualizar{% else %}Cadastrar{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_css %}
<style>
    .card {
        border: none;
        border-radius: 10px;
    }

    .card-header {
        border-radius: 10px 10px 0 0 !important;
        padding: 20px;
        font-weight: 600;
    }

    .card-body {
        padding: 30px;
    }

    .section-title h5 {
        font-weight: 600;
        margin-bottom: 0;
    }

    .form-label {
        color: #2C3E50;
        margin-bottom: 8px;
    }

    .form-control:focus, .form-select:focus {
        border-color: #4CAF50;
        box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25);
    }

    .form-check-input:checked {
        background-color: #4CAF50;
        border-color: #4CAF50;
    }

    .btn-success {
        background-color: #4CAF50;
        border-color: #4CAF50;
        padding: 10px 25px;
        font-weight: 500;
    }

    .btn-success:hover {
        background-color: #45a049;
        border-color: #45a049;
    }

    .img-thumbnail {
        border: 2px solid #4CAF50;
        padding: 5px;
    }
</style>
{% endblock %}
{% endblock %}     